<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.app.gradationback.mapper.ArtistMapper">

<!--    작가 메인페이지(내 프로필) -->
    <select id="selectMyArtistProfile" parameterType="Map" resultType="ArtistDTO">
        SELECT
            TU.ID,
            TU.USER_NAME,
            TU.USER_IMG_NAME,
            TU.USER_IMG_PATH,
            TU.USER_BACKGROUND_IMG_NAME,
            TU.USER_BACKGROUND_IMG_PATH,
            TU.USER_ART_CATEGORY,
            TUS.UNIVERSITY_NAME
        FROM TBL_USER TU
        JOIN TBL_MAJOR TM
            ON TU.MAJOR_ID = TM.ID
        JOIN TBL_UNIVERSITY TUS
            ON TM.UNIVERSITY_ID = TUS.ID
        WHERE TU.ID = #{userId}
          AND TU.USER_WRITER_STATUS = '승인'
    </select>


    <!-- 작가 리스트(내 프로필 제외) -->
    <select id="selectArtistList" parameterType="Map" resultType="ArtistDTO">
        SELECT
            TU.ID,
            TU.USER_NAME,
            TU.USER_IMG_NAME,
            TU.USER_IMG_PATH,
            TU.USER_BACKGROUND_IMG_NAME,
            TU.USER_BACKGROUND_IMG_PATH,
            TU.USER_ART_CATEGORY,
        TUS.UNIVERSITY_NAME
        FROM TBL_USER TU
        JOIN TBL_MAJOR TM
            ON TU.MAJOR_ID = TM.ID
        JOIN TBL_UNIVERSITY TUS
            ON TM.UNIVERSITY_ID = TUS.ID
        WHERE TU.USER_WRITER_STATUS = '승인' AND TU.ID != #{userId}

        <choose>
            <when test="category != null and category.equals('공예')">
                AND TU.USER_ART_CATEGORY = '공예'
            </when>
            <when test="category != null and category.equals('건축')">
                AND TU.USER_ART_CATEGORY = '건축'
            </when>
            <when test="category != null and category.equals('서예')">
                AND TU.USER_ART_CATEGORY = '서예'
            </when>
            <when test="category != null and category.equals('회화')">
                AND TU.USER_ART_CATEGORY = '회화'
            </when>
            <when test="category != null and category.equals('조각')">
                AND TU.USER_ART_CATEGORY = '조각'
            </when>
            <when test="category != null and category.equals('한국화')">
                AND TU.USER_ART_CATEGORY = '한국화'
            </when>
            <otherwise>
                AND TU.USER_ART_CATEGORY = '한국화'
            </otherwise>
        </choose>

        <if test="keyword != null and keyword != ''">
            AND TU.USER_NAME LIKE CONCAT('%', CONCAT(#{keyword}, '%'))
        </if>

        <choose>
            <when test="order != null and order.equals('name')">
                ORDER BY TU.USER_NAME
            </when>
            <when test="order != null and order.equals('recent')">
                ORDER BY TU.ID
            </when>
            <otherwise>
                ORDER BY TU.ID
            </otherwise>
        </choose>

        <choose>
            <when test="direction != null and direction.equals('asc')">
                ASC
            </when>
            <otherwise>
                DESC
            </otherwise>
        </choose>

        OFFSET (#{cursor} - 1) * 15 ROWS
        FETCH NEXT 15 ROWS ONLY
    </select>

<!--    -->


    

</mapper>